---
# Perform following tasks, when applicable
# (e.g. there are nodes in gluster or ceph_* group)
# * Configure firewall
# * Install Tendrl server.
# * Install Tendrl storage nodes.
# * Add Gluster repo.
# * Add Ceph repos.
- include: qe_pre_installation_tasks.yml

# configure firewall
- include: firewall_tendrl.yml
- include: firewall_tendrl_workaround.yml

- include: qe_reboot.yml

- include: tendrl_server.yml

- include: tendrl_node.yml

# Add Centos Gluster YUM repo
- hosts: gluster
  remote_user: root
  roles:
    - gluster-centos-repo
    - gluster-gdeploy-repo

# Install centos-release-ceph package with Ceph Repos
- hosts: ceph_mon:ceph_osd
  remote_user: root
  roles:
    - ceph-centos-repo

# WORKAROUND for https://github.com/ceph/ceph-ansible/issues/1403
# TODO: delete after resolving
- hosts: ceph_osd
  remote_user: root
  tasks:
    - name: Run partprobe
      shell: partprobe || true

# WORKAROUND for https://bugzilla.redhat.com/show_bug.cgi?id=1456552#c5
# TODO: delete after resolving
- hosts: "usm_server:usm_nodes" 
  remote_user: root
  tasks:
    - name: Add user tendrl-user
      user:
        name: tendrl-user
        group: tendrl
